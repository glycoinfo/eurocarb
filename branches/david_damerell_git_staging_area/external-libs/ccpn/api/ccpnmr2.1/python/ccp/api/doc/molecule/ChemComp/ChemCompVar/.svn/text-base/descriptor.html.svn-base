
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<!--Generated by PyApiDocGen on Fri Sep 18 15:07:12 2009-->
<!--======================COPYRIGHT/LICENSE START==========================

index.html: Python API documentation for CCPN data model, package ccp.molecule.ChemComp

Copyright (C) 2007  (CCPN Project)

=======================================================================
The license for this file is in ../../../../../../../..license/LGPL.license
======================COPYRIGHT/LICENSE END============================

for further information, please contact :

- CCPN website (http://www.ccpn.ac.uk/)

- email: ccpn@bioc.cam.ac.uk

=======================================================================
===========================REFERENCE START=============================
===========================REFERENCE END===============================
-->
<HTML>
<head>
  <title>CCPN Python API Attribute: ccp.api.molecule.ChemComp.ChemCompVar.descriptor</title>
  <link rel=stylesheet type="text/css" href="../../../../../../../doc/htmldoc.css">
  <script language="JavaScript">
    function wopn(href){ window.open(href,'','width=880,height=500,top=300,left=300,resizable=0,toolbar=0,location=0,directories=0,status=0,menubar=0,scrollbars=1')}
  </script>
</head>
<body>
<table bgcolor="#F0CC99" border="0" height="100" width="100%">
  <tr>
    <td>
      <a href="http://www.ccpn.ac.uk/" class="mainlogo"><img  alt="CCPN" border="0" id="toplink" src="../../../../../../../doc/graphics/CCPN_Logo_200_x.gif"/></a>
      <br>
      &nbsp;&nbsp;&nbsp;
      Data Model version 2.0.b3
    </td>
    <td valign="center" width="80%">
      <!-- TOP BANNER BEGIN-->
      <div class="topbanner">
        <table border="0" width="100%">
          <tr valign="top">
            <td align="right" width="80%">
              <a href="javascript:wopn('../../../../../../../doc/acknowledgements.html')">Acknowledgements</a>
            </td>
          </tr>
          <tr>
            <td align="center">
              <a href="../../../../../../../model/doc/ccp/molecule/ChemComp.html">Diagram</a>
              |
              <a href="../../../../../../../python/doc/classMap.html">Class Map</a>
              |
              <a href="../../../../../../../python/doc/attributeMap.html">Attribute Map</a>
              |
              <a href="../../../../../../../python/doc/methodMap.html">Method Map</a>
              |
              <a href="javascript:wopn('../../../../../../../doc/help.html')">Help</a>
              |
              <a href="javascript:wopn('../../../../../../../doc/license.html')">License</a>
            </td>
          </tr>
          <tr valign="top">
            <td align="center" valign="bottom">
              <a href="../../../../../../../python/doc/api.html">Home</a>
              |
              <a href="../../../../../../../python/ccp/api/doc/molecule/ChemComp/index.html">Package</a>
              |
              <a href="../../../../../../../python/ccp/api/doc/molecule/ChemComp/ChemCompVar/index.html">Class</a>
              |
              <span class="underover">
              Attribute:
              </span>
              {
              <a href="../../../../../../../python/ccp/api/doc/molecule/ChemComp/ChemCompVar/chemTorsions.html">prev</a>
              |
              <a href="../../../../../../../python/ccp/api/doc/molecule/ChemComp/ChemCompVar/formalCharge.html">next</a>
              }
              |
              Method
            </td>
          </tr>
          <tr>
            <td>
            </td>
          </tr>
        </table>
      </div>
      <!-- TOP BANNER END-->
    </td>
  </tr>
</table>
<table cellpadding="5" width="100%">
  <tr>
    <td>
      <h2>Attribute: descriptor</h2>
      <ul>
      <h3>from Class <a href="index.html">ccp.api.molecule.ChemComp.ChemCompVar</a></h3>
      </ul>
      <br>
      <ul>
      Short string distinguishing the topological variant of the ChemCompVar (e.g. protonation state) of the ChemCompVar. For ChemComps of linear polymer type (only) also distinguishes substitution patterns not related to the polymer bonds. The formatting rules are complex - see comment in 'descriptor_format_rule' constraint for details.
      </ul>
      <br>
      <table cellpadding="2" cellspacing="2">
        <tr>
          <td>
            guid:
          </td>
          <td>
            www.ccpn.ac.uk_Fogh_2006-08-16-18:23:23_00029
          </td>
        </tr>
        <tr>
          <td>
            Model Type:
          </td>
          <td>
            <a href ="../../../../../../../python/memops/api/doc/Implementation/Line.html">Line</a>
          </td>
        </tr>
        <tr>
          <td>
            Implementation Type:
          </td>
          <td>
            String
          </td>
        </tr>
        <tr>
          <td>
            Multiplicity:
          </td>
          <td>
            1..1
          </td>
        </tr>
        <tr>
          <td>
            Changeability:
          </td>
          <td>
            frozen
          </td>
        </tr>
        <tr>
          <td>
            isDerived:
          </td>
          <td>
            False
          </td>
        </tr>
        <tr>
          <td>
            isAutomatic:
          </td>
          <td>
            False
          </td>
        </tr>
        <tr>
          <td>
            isImplementation:
          </td>
          <td>
            False
          </td>
        </tr>
        <tr>
          <td>
            isImplicit:
          </td>
          <td>
            False
          </td>
        </tr>
        <tr>
          <td>
            isAbstract:
          </td>
          <td>
            False
          </td>
        </tr>
        <tr>
          <td>
            Scope:
          </td>
          <td>
            instance_level
          </td>
        </tr>
        <tr>
          <td>
            Default Value:
          </td>
          <td>
            None
          </td>
        </tr>
        <tr valign="top">
          <td>
            <br>Constraint name:
          </td>
          <td>
            <br>descriptor_format_rule
          </td>
        </tr>
        <tr valign="top">
          <td align="right">
            python code
          </td>
          <td>
            # a descriptor is a semicolon-separated string of individual descriptors
            # an individual descriptor is of the form : tag:atName(,atName)+
            # the tags must appear in the order given in validTags,
            # and the atoms must be present
            # examples: 'prot:HD1''  'prot:HD1,HO;deprot:H1;link:SG' 'stereo_2:C1'
            # 'link:C2_2'
            # The ''link' tag is an exception, in that the 'atNames' are actually 
            # LinkEnd.linkCodes. These are atom names, but may in some cases have a '_n'
            # suffix where n is an integer. The linkCodes must correspond to linkEnds present in the ChemCompVar
            # For all other atNames after the tag, atom (name=atName) 
            # must be present in  the ChemCompVar
            # 'stereo' tags are of the form stereo_n, where n is a subType no.
            # and are the only tags to contain an underscore
            # Here, for all atNames after the tag, atom (name=atName, subType=subTypeNo)
            # must be present in  the ChemCompVar. The interpretation is that these
            # atom subtypes are chosen to give the correct stereochemistry; what that
            # stereochemistry is cna be seen by examining the atom network.
            
            # valid special descriptor
            validDescriptors = ('neutral',)
            
            # valid tags (key) and the order they must appear in (value)
            validTags = {'prot':0, 'deprot':1, 'link':2, 'stereo':3,}
            
            isValid = True
            if value is not None and value not in validDescriptors:
            
              chemAtomNames = set()
              linkAtomNames = set()
              for ca in self.chemComp.chemAtoms:
                if isinstance(ca, ChemAtom):
                  chemAtomNames.add(ca.name)
                else:
                  linkAtomNames.add(ca.name)
            
              tagIndex = -1
              for desc in value.split(';'):
            
                try:
                  (tag, text) = desc.split(':', 1)
                except ValueError:
                  # no colon in descriptor
                  print("Malformed descriptor %s: %s does not contain ':'" % (value, `desc`))
                  isValid = False
                  break
                
                # check that tags come in order, 
                # and that _subType come in order for each tag type
                splitTag = tag.split('_')
                tag = splitTag[0]
                if len(splitTag) > 1:
                  if tag == 'stereo':
                    subNo = int(splitTag[1])
                  else:
                    print(
                     "Malformed descriptor %s: only 'stereo' tag may contain underscore'" 
                     % value
                    )
                    isValid = False
                    break
                    
                else:
                  subNo = 0 
                
                ii = validTags.get(tag)
                if ii is None:
                  # tag validity
                  print("Malformed descriptor %s: %s is not a valid tag" % (value, `tag`))
                  isValid = False
                  break
                  
                elif ii < tagIndex:
                  # tag order
                  print("Malformed descriptor %s: tag %s appears out of sequence" % (value, `tag`))
                  isValid = False
                  break
                  
                elif ii == tagIndex:
                  if subNo <= lastSubNo:
                    # tags with subNo not presented in order
                    print("Malformed descriptor %s: %s is out of order" % (value, `desc`))
                    isValid = False
                    break
                    
                else:
                  # moved on to next type of tag
                  tagIndex = ii
                
                lastSubNo = subNo
            
                if tag == 'link':
                  if not self.chemComp.isLinearPolymer:
                    print("Malformed descriptor %s: only linear polymer ChemComps may have 'link' descriptors" % (value,))
                    isValid = False
                    break
                  linkCodes = text.split(',')
                  for ss in ('next', 'prev'):
                    if ss in linkCodes:
                      print ("Malformed descriptor %s: 'link:' section contains %s" % (value, ss))
                      isValid = False
                      break
                  
                  atNames = []
                  chemComp = self.chemComp
                  for lc in linkCodes:
                    if chemComp.findFirstLinkEnd(linkCode=lc) is None:
                      print ("Malformed descriptor %s: 'link:'  %s is not a known linkCode" % (value, lc))
                      isValid = False
                      break
            
                  atNames = []
                  for ss in linkCodes :
                    tt = ss.split('-', 1)
                    atNames.append(tt[0])
                    if len(tt) > 1 and tt[1] not in linkAtomNames:
                      print("Malformed descriptor %s: atom name %s is not a LinkAtom name for ChemCompVar" % (value, tt[1]))
                      isValid = False
                      break
                else:
                  atNames = text.split(',')
                
                  if tag == 'stereo':
                    for aa in atNames:
                      if self.findFirstChemAtom(name=aa, subType=subNo) is None:
                        print("Malformed descriptor %s: atom name %s subtype %s is not in ChemCompVar" % (value, aa, subNo))
                        isValid = False
                        break
                  else:
                    for aa in atNames:
                      if aa not in chemAtomNames:
                        print("Malformed descriptor %s: atom name %s is not in ChemCompVar" % (value, aa))
                        isValid = False
                        break
            
                if not isValid:
                  break
          </td>
        </tr>
      </table>
      <br>
    </td>
  </tr>
</table>

<table borderwidth="1" width="100%"><tr><td width="100%" bgcolor=#794E83></td></tr></table>
<table cellpadding="5" width="100%">
  <tr>
    <td>
      <h3>Methods</h3>
      <table class="elemtable" cellpadding="2" cellspacing="2">
        <tr>
          <td class="tblhead" align="left">
            Method
          </td>
          <td class="tblhead" align="left">
            Return
          </td>
          <td class="tblhead" align="left">
            Parameters
          </td>
          <td class="tblhead" align="left">
            Comment
          </td>
        </tr>
        <tr>
          <td class="tblrow">
            getDescriptor
          </td>
          <td class="tblrow">
            <a href ="../../../../../../../python/memops/api/doc/Implementation/Line.html">Line</a>
          </td>
          <td class="tblrow">
            -
          </td>
          <td class="tblrow">
          </td>
        </tr>
        <tr>
          <td class="tblrow">
            setDescriptor
          </td>
          <td class="tblrow">
            -
          </td>
          <td class="tblrow">
            <a href ="../../../../../../../python/memops/api/doc/Implementation/Line.html">Line</a>
          </td>
          <td class="tblrow">
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>


<table width="100%" cellpadding=2>
  <tr><td colspan=2 width="100%" bgcolor=#794E83></td></tr>
  <tr>
    <td><h5>
    
      &nbsp;
    <em>Data Model Version</em>&nbsp;2.0.b3
    </h5></td>
    <td align=right><a href='#toplink'><span style="font-size:9pt">Go&nbsp;to&nbsp;Top&nbsp;&nbsp;</span></a>
    </td>
  </tr>
</table>

<div class="leftbanner">
<table width=100% cellspacing=0 cellpadding=2 border=0>
  <tr><td bgcolor=#794E83>
    <nobr>
    <em>&nbsp;&nbsp;Autogenerated by</em>&nbsp;&nbsp;PyApiDocGen&nbsp;
    <em>revision</em>&nbsp;1.3&nbsp;&nbsp;
    <em>on</em>&nbsp;&nbsp;Fri Sep 18 15:07:12 2009&nbsp;</nobr>
    <nobr>&nbsp;
    <em>from data model package</em>&nbsp;&nbsp;ccp.api.molecule.ChemComp.ChemCompVar&nbsp;&nbsp;
    <em>revision</em>&nbsp;1.52.2.11&nbsp;&nbsp;</nobr>
  </td></tr>
</table>
</div>
<table width=100% cellspacing=0 cellpadding=2 border=0>
  <tr valign=top>
    <td><h6>&nbsp;&nbsp;Work done by the <a href="mailto:ccpn-dev@mole.bio.cam.ac.uk">CCPN team</a>.</h6></td>
    <td align=right><h6><a target="blank" href="http://www.ccpn.ac.uk">www.ccpn.ac.uk</a>&nbsp;&nbsp;</h6></td>
  </tr>
</table>
<br>

</body>
</HTML>
