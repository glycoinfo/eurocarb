<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
  "-//Hibernate/Hibernate Mapping DTD//EN"
  "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" >

<hibernate-mapping auto-import="false" package="ccp.api.nmr.NmrExpPrototype">
  <class
    name="ExpGraph"
    table="NMRX_EXPGRAPH"
    schema="nmr" 
  >
  <meta attribute="extends" inherit="false">memops.general.AbstractModelObject</meta>
  <meta attribute="implements">java.lang.Comparable</meta>
  <meta attribute="class-description">Set of Connected AtomSites, ExpTransfers, ExpSteps and ExpMeasurements that define the allowed magnetisation transfer paths and observables for an NMR experiment. Each ExpGraph, its ExpSteps and ExpTransfers, and the ExpMeasurements and AtomSites these are connected to, effectively define a self-contained NMR experiment. There may be several ExpGraphs that share some, but not all, AtomSites and ExpMeasurementsl, e.g. if you acquire CH and NH 2D HSQC experiments together, or if you have diferent molecule topologies giving rise to peaks of different sign.</meta>
  <cache usage="read-write"/>

  <id
    name="_dbId"
    access="field"
    column="DATAOBJECTID"
    type="java.lang.Long">
    <meta attribute="scope-set">protected</meta>
    <generator class="native"/>
  </id>
  
  <many-to-one
    name="_topObject"
    access="field"
    column="TOPOBJECTID"
    class="ccp.api.nmr.NmrExpPrototype.NmrExpPrototype"
    not-null="true"
    unique="false"
    foreign-key="NMRX_EXPGRAPH_NMREXPPROT_TO_FK"
  >
    <meta attribute="field-description">hard coded link to topObject</meta>
  </many-to-one>
  
  <property
    name="_peakSign"
    access="field"
    type="java.lang.Integer"
    not-null="false"
  >
    <meta attribute="field-description">Sign of crosspeaks associated with transfer within ExpGraph. If set, all peaks arising from the ExpGraph must have the same sign. Mainly relevant where there are several ExpGraphs that give rise to peaks of different sign.</meta>
    <meta attribute="default-value">null</meta>
    <column name="PEAKSIGN" sql-type="INTEGER" not-null="false"/>
  </property>
  
  <property
    name="_serial"
    access="field"
    type="java.lang.Integer"
    not-null="true"
  >
    <meta attribute="field-description">Serial number of object. Serves as object main key. Serial numbers of deleted objects are not re-used. Serial numbers can only be set by the implementation. Values are in practice always positive, since negative values are interpreted as a signal to set the next free serial</meta>
    <meta attribute="default-value">null</meta>
    <column name="SERIAL" sql-type="INTEGER" not-null="true" unique-key="expGraphUniqueKey" />
  </property>
  
  <list
    name="hbApplicationData"
    table="NMRX_EXPGRAPH2APPLDATA"
      schema="nmr" 
    access="property"
    cascade="all"
  >
    <meta attribute="field-description">Application-specific data</meta>
    <key column="DATAOBJECTID"/>
    <list-index column="ORDER_applicationData_" base="1"/>
    <many-to-many
      column="APPLICATIONDATAID"
      class="memops.api.Implementation.ApplicationData"
      foreign-key="IMPL_DATAOBJECT_APPLDATA_FK"
      unique="true">
    </many-to-many>
  </list>
  
  <many-to-one
    name="hbAccess"
    column="ACCESSID"
    class="memops.api.AccessControl.AccessObject" 
    not-null="false"
    unique="true"
    foreign-key="IMPL_DATAOBJECT_ACCESS_FK" 
  >
    <meta attribute="field-description">Access object that controls object access</meta>
  </many-to-one>
  
  <many-to-one
    name="hbNmrExpPrototype"
    column="NMREXPPROTOTYPEID"
    class="ccp.api.nmr.NmrExpPrototype.NmrExpPrototype" 
    cascade="merge,save-update"
    not-null="true"
    unique="false"
    foreign-key="NMRX_EXPGRAPH_NMREXPPROT_FK" 
    unique-key="expGraphUniqueKey" 
  >
    <meta attribute="field-description">N/A</meta>
  </many-to-one>
  
  <set 
    name="hbExpSteps" 
    table="NMRX_EXPSTEP"
      schema="nmr" 
    inverse="true" 
    cascade="all"
  >
    <meta attribute="field-description">N/A</meta>
    <meta attribute="base-name">hbExpStep</meta>
    <cache usage="read-write"/>
    <key column="EXPGRAPHID"/>
    <one-to-many class="ccp.api.nmr.NmrExpPrototype.ExpStep"/>
  </set>
  
  <set 
    name="hbExpTransfers" 
    table="NMRX_EXPTRANSFER"
      schema="nmr" 
    inverse="true" 
    cascade="all"
  >
    <meta attribute="field-description">N/A</meta>
    <meta attribute="base-name">hbExpTransfer</meta>
    <cache usage="read-write"/>
    <key column="EXPGRAPHID"/>
    <one-to-many class="ccp.api.nmr.NmrExpPrototype.ExpTransfer"/>
  </set>

  </class>

</hibernate-mapping>
