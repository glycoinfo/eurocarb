<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
  "-//Hibernate/Hibernate Mapping DTD//EN"
  "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" >

<hibernate-mapping auto-import="false" package="ccp.api.nmr.Nmr">
  <class
    name="Peak"
    table="NMR_PEAK"
    schema="nmr" 
  >
  <meta attribute="extends" inherit="false">memops.general.AbstractModelObject</meta>
  <meta attribute="implements">java.lang.Comparable</meta>
  <meta attribute="class-description">Crosspeak at a specific position in a specific spectrum.</meta>
  <cache usage="read-write"/>

  <id
    name="_dbId"
    access="field"
    column="DATAOBJECTID"
    type="java.lang.Long">
    <meta attribute="scope-set">protected</meta>
    <generator class="native"/>
  </id>
  
  <many-to-one
    name="_topObject"
    access="field"
    column="TOPOBJECTID"
    class="ccp.api.nmr.Nmr.NmrProject"
    not-null="true"
    unique="false"
    foreign-key="NMR_PEAK_NMRPROJECT_TO_FK"
  >
    <meta attribute="field-description">hard coded link to topObject</meta>
  </many-to-one>
  
  <property
    name="_annotation"
    access="field"
    type="java.lang.String" length="80"
    not-null="false"
  >
    <meta attribute="field-description">Descriptive text string, intended for annotation of Peaks on graphics displays. Long comments belong in the (non-displayed) details attribute.</meta>
    <meta attribute="default-value">null</meta>
    <column name="ANNOTATION" sql-type="VARCHAR(80)" length="80" not-null="false"/>
  </property>
  
  <property
    name="_constraintWeight"
    access="field"
    type="java.lang.Float"
    not-null="true"
  >
    <meta attribute="field-description">Weighting factor for constraint arising from peak. Serves to increase or decrease importance attached to peak, without having to repeat the assignment for every new constraint list generated. In the simple case this number will be used for Constraint.weight</meta>
    <meta attribute="default-value">new java.lang.Float(1.0)</meta>
    <column name="CONSTRAINTWEIGHT" sql-type="FLOAT" not-null="true"/>
  </property>
  
  <property
    name="_details"
    access="field"
    type="java.lang.String" length="254"
    not-null="false"
  >
    <meta attribute="field-description">Free text, for notes, explanatory comments, etc.</meta>
    <meta attribute="default-value">null</meta>
    <column name="DETAILS" sql-type="VARCHAR(254)" length="254" not-null="false"/>
  </property>
  
  <property
    name="_figOfMerit"
    access="field"
    type="java.lang.Float"
    not-null="true"
  >
    <meta attribute="field-description">Figure of merit for peak, describing  its quality (i.e. the likelihood that it is a peak rather than noise). Must be a number between zero and one (inclusive). </meta>
    <meta attribute="default-value">new java.lang.Float(1.0)</meta>
    <column name="FIGOFMERIT" sql-type="FLOAT" not-null="true"/>
  </property>
  
  <property
    name="_serial"
    access="field"
    type="java.lang.Integer"
    not-null="true"
  >
    <meta attribute="field-description">Serial number of object. Serves as object main key. Serial numbers of deleted objects are not re-used. Serial numbers can only be set by the implementation. Values are in practice always positive, since negative values are interpreted as a signal to set the next free serial</meta>
    <meta attribute="default-value">null</meta>
    <column name="SERIAL" sql-type="INTEGER" not-null="true" unique-key="peakUniqueKey" />
  </property>
  
  <set
    name="hbComponentNumbers"
    table="NMR_PEAK_COMPNUMB"
      schema="nmr" 
    cascade="all"
  >
    <meta attribute="field-description">Numbers for the Components where the peak appears. Only relevant for DataSources that are composed of components ShapeMatrix data). If empty corresponds to 'unknown'.</meta>
    <cache usage="read-write" />
    <key column="PEAKID" foreign-key="NMR_PEAK_COMPNUMB_FK"/>
    <element type="java.lang.String" not-null="true">
      <column name="COMPONENTNUMBER" sql-type="INTEGER" not-null="true"/>
    </element>
  </set>
  
  <list
    name="hbApplicationData"
    table="NMR_PEAK2APPLDATA"
      schema="nmr" 
    access="property"
    cascade="all"
  >
    <meta attribute="field-description">Application-specific data</meta>
    <key column="DATAOBJECTID"/>
    <list-index column="ORDER_applicationData_" base="1"/>
    <many-to-many
      column="APPLICATIONDATAID"
      class="memops.api.Implementation.ApplicationData"
      foreign-key="IMPL_DATAOBJECT_APPLDATA_FK"
      unique="true">
    </many-to-many>
  </list>
  
  <many-to-one
    name="hbAccess"
    column="ACCESSID"
    class="memops.api.AccessControl.AccessObject" 
    not-null="false"
    unique="true"
    foreign-key="IMPL_DATAOBJECT_ACCESS_FK" 
  >
    <meta attribute="field-description">Access object that controls object access</meta>
  </many-to-one>
  
  <many-to-one
    name="hbFitMethod"
    column="FITMETHODID"
    class="ccp.api.general.Method.Method" 
    cascade="merge,save-update"
    not-null="false"
    unique="false"
    foreign-key="NMR_PEAK_FITMETHOD_FK" 
  >
    <meta attribute="field-description">Peak fitting method for this particular peak.</meta>
  </many-to-one>
  
  <many-to-one
    name="hbPeakList"
    column="PEAKLISTID"
    class="ccp.api.nmr.Nmr.PeakList" 
    cascade="merge,save-update"
    not-null="true"
    unique="false"
    foreign-key="NMR_PEAK_PEAKLIST_FK" 
    unique-key="peakUniqueKey" 
  >
    <meta attribute="field-description">N/A</meta>
  </many-to-one>
  
  <set 
    name="hbPeakContribs" 
    table="NMR_PEAKCONTRIB"
      schema="nmr" 
    inverse="true" 
    cascade="all"
  >
    <meta attribute="field-description">N/A</meta>
    <meta attribute="base-name">hbPeakContrib</meta>
    <cache usage="read-write"/>
    <key column="PEAKID"/>
    <one-to-many class="ccp.api.nmr.Nmr.PeakContrib"/>
  </set>
  
  <set 
    name="hbPeakDims" 
    table="NMR_PEAKDIM"
      schema="nmr" 
    inverse="true" 
    cascade="all"
  >
    <meta attribute="field-description">N/A</meta>
    <meta attribute="base-name">hbPeakDim</meta>
    <cache usage="read-write"/>
    <key column="PEAKID"/>
    <one-to-many class="ccp.api.nmr.Nmr.PeakDim"/>
  </set>
  
  <set 
    name="hbPeakIntensities" 
    table="NMR_PEAKINTENSITY"
      schema="nmr" 
    inverse="true" 
    cascade="all"
  >
    <meta attribute="field-description">N/A</meta>
    <meta attribute="base-name">hbPeakIntensity</meta>
    <cache usage="read-write"/>
    <key column="PEAKID"/>
    <one-to-many class="ccp.api.nmr.Nmr.PeakIntensity"/>
  </set>
  
  <set 
    name="hbDataDerivations" 
    table="NMR_PEAK2DATADERI"
      schema="nmr" 
    inverse="false" 
    cascade="none"
  >
    <meta attribute="field-description">DataDerivation calculated using Peak</meta>
    <meta attribute="base-name">hbDataDerivation</meta>
    <cache usage="read-write"/>
    <key column="PEAKID" foreign-key="NMR_ABSTDATADERI_PEAKS_FK"/>
    <many-to-many column="DATADERIVATIONID" class="ccp.api.nmr.Nmr.AbstractDataDerivation" foreign-key="NMR_PEAK_DATADERI_FK"/>
  </set>
  
  <set 
    name="hbMeasurements" 
    table="NMR_PEAK2MEAS"
      schema="nmr" 
    inverse="false" 
    cascade="none"
  >
    <meta attribute="field-description">Measurements derived from Peak.</meta>
    <meta attribute="base-name">hbMeasurement</meta>
    <cache usage="read-write"/>
    <key column="PEAKID" foreign-key="NMR_ABSTMEAS_PEAKS_FK"/>
    <many-to-many column="MEASUREMENTID" class="ccp.api.nmr.Nmr.AbstractMeasurement" foreign-key="NMR_PEAK_MEAS_FK"/>
  </set>
  
  <set 
    name="hbPeakClusters" 
    table="NMR_PEAKCLUS2PEAKS"
      schema="nmr" 
    inverse="true" 
    cascade="none"
  >
    <meta attribute="field-description">PeakClusters to which peak belongs. A Peak can belong only to one cluster of a given type. NBNB TBD A constraint must be added to enforce this constraint. </meta>
    <meta attribute="base-name">hbPeakCluster</meta>
    <cache usage="read-write"/>
    <key column="PEAKID" foreign-key="NMR_PEAKCLUS_PEAKS_FK"/>
    <many-to-many column="PEAKCLUSTERID" class="ccp.api.nmr.Nmr.PeakCluster" foreign-key="NMR_PEAK_PEAKCLUS_FK"/>
  </set>
  
  <set 
    name="hbPeakValidations" 
    table="NMR_PEAK2PEAKVALI"
      schema="nmr" 
    inverse="false" 
    cascade="none"
  >
    <meta attribute="field-description">Validation results that include Peak</meta>
    <meta attribute="base-name">hbPeakValidation</meta>
    <cache usage="read-write"/>
    <key column="PEAKID" foreign-key="VALD_PEAKVALI_PEAKS_FK"/>
    <many-to-many column="PEAKVALIDATIONID" class="ccp.api.molecule.Validation.PeakValidation" foreign-key="NMR_PEAK_PEAKVALI_FK"/>
  </set>

  </class>

</hibernate-mapping>
