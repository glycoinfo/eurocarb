<?xml version='1.0'?>
<!--
#######################################################################

CCPN Data Model version 2.0.b3

Autogenerated by XmlModelIo revision 1.17 on ?
  from data model element ccp.nmr.NmrReference.ChemAtomNmrRef revision ?

#######################################################################
======================COPYRIGHT/LICENSE START==========================

ChemAtomNmrRef.xml: xmlmodel model for CCPN data model, MetaClass ccp.nmr.NmrReference.ChemAtomNmrRef

Copyright (C) 2007 Rasmus Fogh (CCPN Project)

=======================================================================

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.
 
A copy of this license can be found in ../../../../../license/LGPL.license
 
This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.
 
You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA


======================COPYRIGHT/LICENSE END============================

for further information, please contact :

- CCPN website (http://www.ccpn.ac.uk/)

- email: ccpn@bioc.cam.ac.uk

=======================================================================

If you are using this software for academic purposes, we suggest
quoting the following references:

===========================REFERENCE START=============================
Wim F. Vranken, Wayne Boucher, Tim J. Stevens, Rasmus
H. Fogh, Anne Pajon, Miguel Llinas, Eldon L. Ulrich, John L. Markley, John
Ionides and Ernest D. Laue (2005). The CCPN Data Model for NMR Spectroscopy:
Development of a Software Pipeline. Proteins 59, 687 - 696.

Rasmus H. Fogh, Wayne Boucher, Wim F. Vranken, Anne
Pajon, Tim J. Stevens, T.N. Bhat, John Westbrook, John M.C. Ionides and
Ernest D. Laue (2005). A framework for scientific data modeling and automated
software development. Bioinformatics 21, 1678-1684.


This file was generated with the Memops software generation framework,
and contains original contributions embedded in the framework

===========================REFERENCE END===============================
-->

<MetaClass name="ChemAtomNmrRef"
 guid="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
 container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:08_00001"
 isAbstract="false" isImplicit="false" isLeaf="false" isRoot="false"
 isSingleton="false" partitionsChildren="false" visibility="public_vis">
  <documentation>Information about refrence chemical shift for a ChemAtom. The information may apply to a ChemAtom in all ChemCompVars (linking and descriptor both 'any'), in some ChemCompVars (either linking or descriptor 'any') or in a specific ChemCompVar (all other cases). Either the meanValue or the randomCoilValue attribute must be set.</documentation>
  <keyNames>
    <item>serial</item>
  </keyNames>
  <supertypes>
    <item>www.ccpn.ac.uk_Fogh_2006-09-14-16:28:57_00005</item>
  </supertypes>
  <taggedValues>
    <item tag="repositoryId">$Id: ChemAtomNmrRef.xml,v 1.43.2.12 2009/09/14 14:45:21 wimvranken Exp $</item>
    <item tag="repositoryTag">$Name: release_2_1_0_2 $</item>
  </taggedValues>

  <!-- Start constraints for <MetaClass: ccp.nmr.NmrReference.ChemAtomNmrRef>: -->
  <MetaConstraint name="Distribution_is_normalised"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00003"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   isImplicit="false">
    <codeStubs>
      <item tag="java">isValid = true;

float floatTolerance = 0.00001f;
java.util.Collection&lt;java.lang.Float&gt; distribution = getDistribution();

if (!distribution.isEmpty())
{
  java.util.Iterator&lt;java.lang.Float&gt; iter = distribution.iterator();
  float sum = 0.0f;

  while (iter.hasNext())
  {
    java.lang.Float xx = iter.next();
    sum += xx;
  }
  
  if (java.lang.Math.abs(sum-1.0f) &gt; floatTolerance)
    isValid = false;
}
</item>
      <item tag="python">isValid = True

ll = self.distribution
if ll:
  floatTolerance = 1.0e-5

  if abs(sum(ll)-1.0) &gt; floatTolerance:
    isValid = False
</item>
    </codeStubs>
  </MetaConstraint>
  <MetaConstraint name="meanValue_or_randomCoilValue_must_be_set"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00004"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   isImplicit="false">
    <codeStubs>
      <item tag="java">(getMeanValue() != null || getRandomCoilValue() != null)</item>
      <item tag="python">self.meanValue is not None or self.randomCoilValue is not None</item>
    </codeStubs>
  </MetaConstraint>
  <!-- End constraints for <MetaClass: ccp.nmr.NmrReference.ChemAtomNmrRef>: -->


  <MetaOperation name="addDistribution"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00024"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   isAbstract="false" isImplicit="false" isQuery="false" opType="add"
   scope="instance_level" visibility="public_vis">
    <documentation>Modify command for distribution. Specifically entered here to make sure command is disabled</documentation>
    <target>www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00013</target>
    <codeStubs>
      <item tag="java">if (notIsReading)
  throw new memops.general.ApiException("The addDistribution operation is not valid and cannot be used");</item>
      <item tag="python">raise ApiError("The %s.addDistribution method is invalid and cannot be used" % self.className)</item>
    </codeStubs>
  </MetaOperation>

  <MetaRole name="chemAtomShiftCorrs"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00006"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="chemAtomShiftCorr" changeability="changeable" hicard="-1"
   hierarchy="child" isAbstract="false" isAutomatic="false" isDerived="false"
   isImplementation="false" isImplicit="false" isOrdered="false" isUnique="true"
   locard="0" noDeleteIfSet="false" partitionsChildren="false"
   scope="instance_level" visibility="public_vis">
    <otherRole>www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00005</otherRole>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00005</valueType>
  </MetaRole>

  <MetaRole name="chemAtoms"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00004"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="chemAtom" changeability="frozen" hicard="-1" isAbstract="false"
   isAutomatic="false" isDerived="true" isImplementation="false"
   isImplicit="false" isOrdered="false" isUnique="true" locard="1"
   noDeleteIfSet="false" partitionsChildren="false" scope="instance_level"
   visibility="public_vis">
    <documentation>ChemAtom to which reference information applies.</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:52_00001</valueType>
  </MetaRole>

  <MetaRole name="chemCompNmrRef"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:36_00102"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   aggregation="composite" baseName="chemCompNmrRef" changeability="frozen"
   hicard="1" hierarchy="parent" isAbstract="false" isAutomatic="false"
   isDerived="false" isImplementation="false" isImplicit="false"
   isOrdered="false" isUnique="true" locard="1" noDeleteIfSet="false"
   partitionsChildren="false" scope="instance_level" visibility="public_vis">
    <otherRole>www.ccpn.ac.uk_Fogh_2006-08-16-18:23:36_00103</otherRole>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00001</valueType>
  </MetaRole>

  <MetaRole name="chemCompVarNmrRefs"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00033"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="chemCompVarNmrRef" changeability="changeable" hicard="-1"
   isAbstract="false" isAutomatic="false" isDerived="false"
   isImplementation="false" isImplicit="false" isOrdered="false" isUnique="true"
   locard="1" noDeleteIfSet="false" partitionsChildren="false"
   scope="instance_level" visibility="public_vis">
    <documentation>ChemCompNmrRefs that contain this ChemAtomNmrRef.</documentation>
    <otherRole>www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00034</otherRole>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00006</valueType>
  </MetaRole>

  <MetaAttribute name="distribution"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00013"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="distribution" changeability="changeable" hicard="-1"
   isAbstract="false" isAutomatic="false" isDerived="false"
   isImplementation="false" isImplicit="false" isOrdered="true" isUnique="false"
   locard="0" scope="instance_level" visibility="public_vis">
    <documentation>histogram of frequency distribution. Normalised - must sum to 1.0. The shifts to which the individual points belong are defined so that point i collects the  shifts from 
refValue + valuePerPoint*( i-refPoint) to refValue + valuePerPoint*( i+1-refPoint).</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00031</valueType>
  </MetaAttribute>

  <MetaOperation name="getChemAtoms"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00018"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   isAbstract="false" isImplicit="false" isQuery="true" opType="get"
   scope="instance_level" visibility="public_vis">
    <documentation>getter for derived link chemAtoms</documentation>
    <target>www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00004</target>
    <codeStubs>
      <item tag="java">ccp.api.molecule.ChemComp.ChemComp chemComp = getChemCompNmrRef().getNmrReferenceStore().getChemComp();
java.lang.String name = getName();
java.lang.Integer subType = getSubType();

result = chemComp.findAllChemAtoms("name", name,  "subType", subType);

if (result.isEmpty()) {
  ccp.api.molecule.ChemComp.ChemAtomSet chemAtomSet = chemComp.findFirstChemAtomSet("name", name,  "subType", subType);

  if (chemAtomSet == null)
    throw new memops.general.ApiException(" no ChemAtom or ChemAtomSet found for :" + chemComp.getMolType() + ", " + chemComp.getCcpCode() + ", " + name + ", " + subType);

  java.util.List&lt;ccp.api.molecule.ChemComp.ChemAtomSet&gt; chemAtomSets = new java.util.LinkedList&lt;ccp.api.molecule.ChemComp.ChemAtomSet&gt;();
  chemAtomSets.add(chemAtomSet);
  while (!chemAtomSets.isEmpty()) {
    ccp.api.molecule.ChemComp.ChemAtomSet cas = chemAtomSets.remove(0);
    chemAtomSets.addAll(cas.getChemAtomSets());
    result.addAll(cas.getChemAtoms());
  }
}</item>
      <item tag="python">chemComp = self.topObject.chemComp
name = self.name
subType = self.subType

result = chemComp.findAllChemAtoms(name=name, subType=subType)

if not result:
  chemAtomSet = chemComp.findFirstChemAtomSet(name=name, subType=subType)
 
  if chemAtomSet is None:
    raise ApiError(" no ChemAtom or ChemAtomSet found for: %s, %s, %s, %s"
                   % (chemComp.molType, chemComp.ccpCode, name, subType))

  else:
    chemAtomSets = [chemAtomSet]
    chemAtoms = []
    for cas in chemAtomSets:
      chemAtomSets.extend(cas.chemAtomSets)
      chemAtoms.extend(cas.chemAtoms)
  #
  result = frozenset(chemAtoms)
 </item>
    </codeStubs>
  </MetaOperation>

  <MetaOperation name="getNumPoints"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00020"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   isAbstract="false" isImplicit="false" isQuery="true" opType="get"
   scope="instance_level" visibility="public_vis">
    <documentation>getter for derived attribute numPoints</documentation>
    <target>www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00014</target>
    <codeStubs>
      <item tag="java">result = getDistribution().size();</item>
      <item tag="python">result = len(self.distribution)</item>
    </codeStubs>
  </MetaOperation>

  <MetaAttribute name="meanValue"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00010"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="meanValue" changeability="changeable" hicard="1" isAbstract="false"
   isAutomatic="false" isDerived="false" isImplementation="false"
   isImplicit="false" isOrdered="false" isUnique="true" locard="0"
   scope="instance_level" visibility="public_vis">
    <documentation>Average predicted chemical shift value (in ppm)</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00031</valueType>
  </MetaAttribute>

  <MetaAttribute name="name"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00008"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="name" changeability="frozen" hicard="1" isAbstract="false"
   isAutomatic="false" isDerived="false" isImplementation="false"
   isImplicit="false" isOrdered="false" isUnique="true" locard="1"
   scope="instance_level" visibility="public_vis">
    <documentation>Name of ChemAtom. Part of key for object.</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00037</valueType>
  </MetaAttribute>

  <MetaAttribute name="numPoints"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00014"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="numPoints" changeability="frozen" hicard="1" isAbstract="false"
   isAutomatic="false" isDerived="true" isImplementation="false"
   isImplicit="false" isOrdered="false" isUnique="true" locard="1"
   scope="instance_level" visibility="public_vis">
    <documentation>Number of points in shift distribution</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00032</valueType>
  </MetaAttribute>

  <MetaAttribute name="randomCoilValue"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00012"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="randomCoilValue" changeability="changeable" hicard="1"
   isAbstract="false" isAutomatic="false" isDerived="false"
   isImplementation="false" isImplicit="false" isOrdered="false" isUnique="true"
   locard="0" scope="instance_level" visibility="public_vis">
    <documentation>Chemical shift for random coil conformation. Need not be the same as the mean value over the known distribution.</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00031</valueType>
  </MetaAttribute>

  <MetaAttribute name="refPoint"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00015"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="refPoint" changeability="changeable" hicard="1" isAbstract="false"
   isAutomatic="false" isDerived="false" isImplementation="false"
   isImplicit="false" isOrdered="false" isUnique="true" locard="1"
   scope="instance_level" visibility="public_vis">
    <documentation>Reference point number (in floating point, first point is 0.0) for referencing chemical shift axis of distribution.</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00031</valueType>
    <defaultValue>
      <item>1.0</item>
    </defaultValue>
  </MetaAttribute>

  <MetaAttribute name="refValue"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00016"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="refValue" changeability="changeable" hicard="1" isAbstract="false"
   isAutomatic="false" isDerived="false" isImplementation="false"
   isImplicit="false" isOrdered="false" isUnique="true" locard="1"
   scope="instance_level" visibility="public_vis">
    <documentation>Reference value (in ppm) for setting chemical shift axis of distribution.</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00031</valueType>
    <defaultValue>
      <item>0.0</item>
    </defaultValue>
  </MetaAttribute>

  <MetaOperation name="removeDistribution"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00022"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   isAbstract="false" isImplicit="false" isQuery="false" opType="remove"
   scope="instance_level" visibility="public_vis">
    <documentation>Modify command for distribution. Specifically entered here to make sure command is disabled</documentation>
    <target>www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00013</target>
    <codeStubs>
      <item tag="java">if (notIsReading)
  throw new memops.general.ApiException("The removeDistribution operation is not valid and cannot be used");</item>
      <item tag="python">raise ApiError("The %s.removeDistribution operation is not valid and cannot be used" % self.className)</item>
    </codeStubs>
  </MetaOperation>

  <MetaAttribute name="serial"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00007"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="serial" changeability="frozen" hicard="1" isAbstract="false"
   isAutomatic="true" isDerived="false" isImplementation="false"
   isImplicit="false" isOrdered="false" isUnique="true" locard="1"
   scope="instance_level" visibility="public_vis">
    <documentation>Serial number of object. Serves as object main key. Serial numbers of deleted objects are not re-used. Serial numbers can only be set by the implementation. Values are in practice always positive, since negative values are interpreted as a signal to set the next free serial</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00032</valueType>
  </MetaAttribute>

  <MetaAttribute name="stdDev"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00011"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="stdDev" changeability="changeable" hicard="1" isAbstract="false"
   isAutomatic="false" isDerived="false" isImplementation="false"
   isImplicit="false" isOrdered="false" isUnique="true" locard="0"
   scope="instance_level" visibility="public_vis">
    <documentation>Standard deviation (in ppm) over the chemical shift distribution</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00031</valueType>
  </MetaAttribute>

  <MetaAttribute name="subType"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00009"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="subType" changeability="frozen" hicard="1" isAbstract="false"
   isAutomatic="false" isDerived="false" isImplementation="false"
   isImplicit="false" isOrdered="false" isUnique="true" locard="1"
   scope="instance_level" visibility="public_vis">
    <documentation>subType of ChemAtom referred to.</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00032</valueType>
    <defaultValue>
      <item>1</item>
    </defaultValue>
  </MetaAttribute>

  <MetaAttribute name="valuePerPoint"
   guid="www.ccpn.ac.uk_Fogh_2006-08-16-18:23:37_00017"
   container="www.ccpn.ac.uk_Fogh_2006-08-16-14:25:09_00002"
   baseName="valuePerPoint" changeability="changeable" hicard="1"
   isAbstract="false" isAutomatic="false" isDerived="false"
   isImplementation="false" isImplicit="false" isOrdered="false" isUnique="true"
   locard="0" scope="instance_level" visibility="public_vis">
    <documentation>The value per point on the histogram axis, equivalent to the width of a column.</documentation>
    <valueType>www.ccpn.ac.uk_Fogh_2006-08-16-14:22:53_00031</valueType>
  </MetaAttribute>
</MetaClass>

